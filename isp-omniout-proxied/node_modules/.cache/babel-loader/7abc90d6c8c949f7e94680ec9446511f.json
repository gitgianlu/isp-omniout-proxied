{"ast":null,"code":"module.exports = MultiStream;\n\nvar inherits = require('inherits');\n\nvar stream = require('readable-stream');\n\ninherits(MultiStream, stream.Readable);\n\nfunction MultiStream(streams, opts) {\n  var self = this;\n  if (!(self instanceof MultiStream)) return new MultiStream(streams, opts);\n  stream.Readable.call(self, opts);\n  self.destroyed = false;\n  self._drained = false;\n  self._forwarding = false;\n  self._current = null;\n  self._toStreams2 = opts && opts.objectMode ? toStreams2Obj : toStreams2Buf;\n\n  if (typeof streams === 'function') {\n    self._queue = streams;\n  } else {\n    self._queue = streams.map(self._toStreams2);\n\n    self._queue.forEach(function (stream) {\n      if (typeof stream !== 'function') self._attachErrorListener(stream);\n    });\n  }\n\n  self._next();\n}\n\nMultiStream.obj = function (streams) {\n  return new MultiStream(streams, {\n    objectMode: true,\n    highWaterMark: 16\n  });\n};\n\nMultiStream.prototype._read = function () {\n  this._drained = true;\n\n  this._forward();\n};\n\nMultiStream.prototype._forward = function () {\n  if (this._forwarding || !this._drained || !this._current) return;\n  this._forwarding = true;\n  var chunk;\n\n  while ((chunk = this._current.read()) !== null) {\n    this._drained = this.push(chunk);\n  }\n\n  this._forwarding = false;\n};\n\nMultiStream.prototype.destroy = function (err) {\n  if (this.destroyed) return;\n  this.destroyed = true;\n  if (this._current && this._current.destroy) this._current.destroy();\n\n  if (typeof this._queue !== 'function') {\n    this._queue.forEach(function (stream) {\n      if (stream.destroy) stream.destroy();\n    });\n  }\n\n  if (err) this.emit('error', err);\n  this.emit('close');\n};\n\nMultiStream.prototype._next = function () {\n  var self = this;\n  self._current = null;\n\n  if (typeof self._queue === 'function') {\n    self._queue(function (err, stream) {\n      if (err) return self.destroy(err);\n      stream = self._toStreams2(stream);\n\n      self._attachErrorListener(stream);\n\n      self._gotNextStream(stream);\n    });\n  } else {\n    var stream = self._queue.shift();\n\n    if (typeof stream === 'function') {\n      stream = self._toStreams2(stream());\n\n      self._attachErrorListener(stream);\n    }\n\n    self._gotNextStream(stream);\n  }\n};\n\nMultiStream.prototype._gotNextStream = function (stream) {\n  var self = this;\n\n  if (!stream) {\n    self.push(null);\n    self.destroy();\n    return;\n  }\n\n  self._current = stream;\n\n  self._forward();\n\n  stream.on('readable', onReadable);\n  stream.once('end', onEnd);\n  stream.once('close', onClose);\n\n  function onReadable() {\n    self._forward();\n  }\n\n  function onClose() {\n    if (!stream._readableState.ended) {\n      self.destroy();\n    }\n  }\n\n  function onEnd() {\n    self._current = null;\n    stream.removeListener('readable', onReadable);\n    stream.removeListener('end', onEnd);\n    stream.removeListener('close', onClose);\n\n    self._next();\n  }\n};\n\nMultiStream.prototype._attachErrorListener = function (stream) {\n  var self = this;\n  if (!stream) return;\n  stream.once('error', onError);\n\n  function onError(err) {\n    stream.removeListener('error', onError);\n    self.destroy(err);\n  }\n};\n\nfunction toStreams2Obj(s) {\n  return toStreams2(s, {\n    objectMode: true,\n    highWaterMark: 16\n  });\n}\n\nfunction toStreams2Buf(s) {\n  return toStreams2(s);\n}\n\nfunction toStreams2(s, opts) {\n  if (!s || typeof s === 'function' || s._readableState) return s;\n  var wrap = new stream.Readable(opts).wrap(s);\n\n  if (s.destroy) {\n    wrap.destroy = s.destroy.bind(s);\n  }\n\n  return wrap;\n}","map":{"version":3,"sources":["/Users/gcarminati/Desktop/OmniStudio/OmniProxy/react-express-proxy-sample/node_modules/multistream/index.js"],"names":["module","exports","MultiStream","inherits","require","stream","Readable","streams","opts","self","call","destroyed","_drained","_forwarding","_current","_toStreams2","objectMode","toStreams2Obj","toStreams2Buf","_queue","map","forEach","_attachErrorListener","_next","obj","highWaterMark","prototype","_read","_forward","chunk","read","push","destroy","err","emit","_gotNextStream","shift","on","onReadable","once","onEnd","onClose","_readableState","ended","removeListener","onError","s","toStreams2","wrap","bind"],"mappings":"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","sourcesContent":["module.exports = MultiStream\n\nvar inherits = require('inherits')\nvar stream = require('readable-stream')\n\ninherits(MultiStream, stream.Readable)\n\nfunction MultiStream (streams, opts) {\n  var self = this\n  if (!(self instanceof MultiStream)) return new MultiStream(streams, opts)\n  stream.Readable.call(self, opts)\n\n  self.destroyed = false\n\n  self._drained = false\n  self._forwarding = false\n  self._current = null\n  self._toStreams2 = (opts && opts.objectMode) ? toStreams2Obj : toStreams2Buf\n\n  if (typeof streams === 'function') {\n    self._queue = streams\n  } else {\n    self._queue = streams.map(self._toStreams2)\n    self._queue.forEach(function (stream) {\n      if (typeof stream !== 'function') self._attachErrorListener(stream)\n    })\n  }\n\n  self._next()\n}\n\nMultiStream.obj = function (streams) {\n  return new MultiStream(streams, { objectMode: true, highWaterMark: 16 })\n}\n\nMultiStream.prototype._read = function () {\n  this._drained = true\n  this._forward()\n}\n\nMultiStream.prototype._forward = function () {\n  if (this._forwarding || !this._drained || !this._current) return\n  this._forwarding = true\n\n  var chunk\n  while ((chunk = this._current.read()) !== null) {\n    this._drained = this.push(chunk)\n  }\n\n  this._forwarding = false\n}\n\nMultiStream.prototype.destroy = function (err) {\n  if (this.destroyed) return\n  this.destroyed = true\n\n  if (this._current && this._current.destroy) this._current.destroy()\n  if (typeof this._queue !== 'function') {\n    this._queue.forEach(function (stream) {\n      if (stream.destroy) stream.destroy()\n    })\n  }\n\n  if (err) this.emit('error', err)\n  this.emit('close')\n}\n\nMultiStream.prototype._next = function () {\n  var self = this\n  self._current = null\n\n  if (typeof self._queue === 'function') {\n    self._queue(function (err, stream) {\n      if (err) return self.destroy(err)\n      stream = self._toStreams2(stream)\n      self._attachErrorListener(stream)\n      self._gotNextStream(stream)\n    })\n  } else {\n    var stream = self._queue.shift()\n    if (typeof stream === 'function') {\n      stream = self._toStreams2(stream())\n      self._attachErrorListener(stream)\n    }\n    self._gotNextStream(stream)\n  }\n}\n\nMultiStream.prototype._gotNextStream = function (stream) {\n  var self = this\n\n  if (!stream) {\n    self.push(null)\n    self.destroy()\n    return\n  }\n\n  self._current = stream\n  self._forward()\n\n  stream.on('readable', onReadable)\n  stream.once('end', onEnd)\n  stream.once('close', onClose)\n\n  function onReadable () {\n    self._forward()\n  }\n\n  function onClose () {\n    if (!stream._readableState.ended) {\n      self.destroy()\n    }\n  }\n\n  function onEnd () {\n    self._current = null\n    stream.removeListener('readable', onReadable)\n    stream.removeListener('end', onEnd)\n    stream.removeListener('close', onClose)\n    self._next()\n  }\n}\n\nMultiStream.prototype._attachErrorListener = function (stream) {\n  var self = this\n  if (!stream) return\n\n  stream.once('error', onError)\n\n  function onError (err) {\n    stream.removeListener('error', onError)\n    self.destroy(err)\n  }\n}\n\nfunction toStreams2Obj (s) {\n  return toStreams2(s, {objectMode: true, highWaterMark: 16})\n}\n\nfunction toStreams2Buf (s) {\n  return toStreams2(s)\n}\n\nfunction toStreams2 (s, opts) {\n  if (!s || typeof s === 'function' || s._readableState) return s\n\n  var wrap = new stream.Readable(opts).wrap(s)\n  if (s.destroy) {\n    wrap.destroy = s.destroy.bind(s)\n  }\n  return wrap\n}\n"]},"metadata":{},"sourceType":"script"}